!function(c){c.fn.serializeObject=function(){"use strict";var a={};return c.each(this.serializeArray(),function(e,t){var n=a[t.name];null!=n?c.isArray(n)?n.push(t.value):a[t.name]=[n,t.value]:a[t.name]=t.value}),a};window.C4gPn=new function(){function o(n,t,a){t=t||{},a=a||"";var o=480,i=360,s=[{text:C4GLANG.close,icons:{primary:"ui-icon-close"},click:function(){c(this).dialog("close"),c("#modal-"+n).remove()}}];"compose"==n&&(o=480,i=360,s.unshift({text:C4GLANG.send,icons:{primary:"ui-icon-arrowreturnthick-1-w"},click:function(){c("#frmCompose").submit()}})),"view"==n&&(o=480,i=360,s.unshift({text:C4GLANG.delete,icons:{primary:"ui-icon-trash"},click:function(){e(t.id),c(this).dialog("close")}}),s.unshift({text:C4GLANG.reply,icons:{primary:"ui-icon-arrowreturnthick-1-w"},click:function(){var e="RE: "+c(".subject").text();r(t.sid,e,e,this),c(this).dialog("close")}})),c.ajax({method:"GET",url:pnApiBaseUrl+"/modal/"+n,data:{data:t},success:function(e){c("#modal-"+n).remove(),c("body").append(e.template),c("#modal-"+n).dialog({title:a,minWidth:o,minHeight:i,close:function(e,t){c("#modal-"+n).remove()},buttons:s});e=document.getElementById("frmCompose");null!=e&&(e.dataset.target=t.target)}})}var e=function(t){1==confirm(C4GLANG.delete_confirm)&&c.ajax({method:"DELETE",url:pnApiBaseUrl+"/delete/"+t,success:function(e){1==e.success&&c("#message-"+t).remove()}})},r=function(e,t,n,a){"undefined"!=typeof event&&event.preventDefault(),n=n||"",o("compose",{recipient_id:e,subject:t=t||"",target:a.getAttribute("data-target")},n)};return{sendMessage:function(e){var t=c(e).serializeObject();t.target=e.dataset.target,c.ajax({method:"POST",url:pnApiBaseUrl+"/send/",data:t,success:function(e){!0!==e.success?alert(C4GLANG.send_error):c("#modal-compose").dialog("close")}})},sendMessageTo:r,deleteMessage:e,openModal:o,parseHTMLCode:function(e){var t=document.createElement("div");t.innerHTML=c(e).html(),c(e).html(c(t).text())},initCKEditor:function(){var e=CKEDITOR.replace("ckeditor",{toolbar:[{name:"all",items:["Cut","Copy","Paste","PasteText","PasteFromWord","-","Undo","Redo","Bold","Italic","Underline","Strike","Subscript","Superscript","Blockquote","-","RemoveFormat","NumberedList","BulletedList","Link","Unlink","Anchor","Image","TextColor","BGColor"]}],extraPlugins:"justify,fileUpload,bbcode,panelbutton,floatpanel,colorbutton,blockquote,youtube",language:sCurrentLang,defaultLanguage:"en",height:"360",disableObjectResizing:!0,filebrowserImageUploadUrl:"con4gis/upload/image",filebrowserUploadUrl:"bundles/con4giscore/vendor/C4GFileUpload.php"});CKEDITOR.on("instanceReady",function(){c.each(CKEDITOR.instances,function(t){CKEDITOR.instances[t].on("change",function(e){for(t in CKEDITOR.instances)CKEDITOR.instances[t].updateElement()})})}),e.focus()},markAsRead:function(t){c.ajax({method:"POST",url:pnApiBaseUrl+"/mark",data:{status:1,id:t},success:function(e){!0!==e.success?alert(e.message):c("#message-"+t+".unread").removeClass("unread").addClass("read")}})}}}}(jQuery);